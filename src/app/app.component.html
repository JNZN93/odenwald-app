<div class="app-container" [class.wholesaler-route]="isWholesalerRoute">
  <header class="app-header header-gradient" [class.hidden]="isWholesalerRoute">
    <div class="header-content container">
      <div class="header-left">
        <div class="logo-section">
          <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
          <div class="title-container">
            <span class="title-brand">ODNWLD</span>
            <span class="title-action">liefert</span>
          </div>
        </div>
        <p class="app-subtitle">Ihre regionale Lieferplattform</p>
      </div>

      <!-- Mobile Menu Button -->
      <button class="mobile-menu-btn" (click)="toggleMobileNav()" [class.active]="isMobileNavOpen">
        <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      <nav class="main-nav">
        <!-- Essen bestellen nur für Kunden (nicht für App-Admins) -->
        <a *ngIf="!isAuthenticated || hasCustomerRole" routerLink="/customer" routerLinkActive="active" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <!-- Einfacher Teller für "Essen bestellen" -->
            <ellipse cx="12" cy="16" rx="8" ry="2"/>
            <ellipse cx="12" cy="14" rx="6" ry="1.5"/>
          </svg>
          <span class="nav-text">Essen bestellen</span>
        </a>
        <a *ngIf="!isAuthenticated || hasCustomerRole" routerLink="/auth/register-restaurant" routerLinkActive="active" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l8 4v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6l8-4z"/>
            <path d="M8 10h8"/>
            <path d="M8 14h8"/>
            <circle cx="16" cy="8" r="1"/>
            <path d="M9 18l2 2 4-4"/>
          </svg>
          <span class="nav-text">Partner werden</span>
        </a>
        <a *ngIf="!isAuthenticated || hasCustomerRole" routerLink="/auth/register-wholesaler" routerLinkActive="active" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <!-- Großhandels-Icon: Warehouse/Storage -->
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <rect x="7" y="7" width="10" height="4"/>
            <rect x="7" y="13" width="10" height="4"/>
            <line x1="7" y1="11" x2="17" y2="11"/>
          </svg>
          <span class="nav-text">Großhändler werden</span>
        </a>
        <a *ngIf="hasAdminRole" routerLink="/admin" routerLinkActive="active" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
          <span class="nav-text">Admin</span>
        </a>

        <!-- Customer Dashboard Link nur für Kunden -->
        <a *ngIf="hasCustomerRole" routerLink="/dashboard" routerLinkActive="active" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <path d="M9 9h6v6H9z"/>
            <path d="M9 1v6"/>
            <path d="M15 1v6"/>
            <path d="M9 17v6"/>
            <path d="M15 17v6"/>
            <path d="M1 9h6"/>
            <path d="M17 9h6"/>
            <path d="M1 15h6"/>
            <path d="M17 15h6"/>
          </svg>
          <span class="nav-text">Mein Dashboard</span>
        </a>

        <!-- Driver Dashboard Link nur für Fahrer -->
        <a *ngIf="hasDriverRole" routerLink="/driver-dashboard" routerLinkActive="active" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="3" width="15" height="13"/>
            <polygon points="16,8 20,8 23,11 23,16 16,16 16,8"/>
            <circle cx="5.5" cy="18.5" r="2.5"/>
            <circle cx="18.5" cy="18.5" r="2.5"/>
          </svg>
          <span class="nav-text">Fahrer-Dashboard</span>
        </a>
      </nav>

      <div class="header-right">
        <!-- Restaurant Name für Manager -->
        <div class="restaurant-name-section" *ngIf="hasManagerRole">
          <div class="restaurant-name-display" (click)="toggleRoleDisplay()" [class.showing-role]="showRole">
            <svg class="restaurant-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
            <span class="restaurant-name">{{ getSelectedRestaurantName() || 'Restaurant' }}</span>
            <span class="user-role" *ngIf="showRole">{{ getCurrentUserRole() }}</span>
          </div>
        </div>

        <div class="user-section">
          <ng-container *ngIf="isAuthenticated; else guestSection">
            <div class="user-info">
              <svg class="user-avatar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <span class="user-name">{{ (currentUser$ | async)?.name || 'User' }}</span>
            </div>
            <button class="btn btn-ghost" (click)="logout()">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16,17 21,12 16,7"/>
                <line x1="21" y1="12" x2="3" y2="12"/>
              </svg>
              Abmelden
            </button>
          </ng-container>
          <ng-template #guestSection>
            <div class="user-info">
              <svg class="user-avatar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <span class="user-name">Gast</span>
            </div>
            <button class="btn btn-primary" routerLink="/auth/login" type="button">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                <polyline points="10,17 15,12 10,7"/>
                <line x1="15" y1="12" x2="3" y2="12"/>
              </svg>
              Anmelden
            </button>
          </ng-template>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Side Navigation -->
  <nav class="mobile-nav-overlay" [class.open]="isMobileNavOpen" (click)="closeMobileNav()">
    <div class="mobile-nav-content" (click)="$event.stopPropagation()">
      <div class="mobile-nav-header">
        <div class="mobile-nav-logo">
          <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
          <div class="title-container">
            <span class="title-brand">ODNWLD</span>
            <span class="title-action">liefert</span>
          </div>
        </div>
        <button class="mobile-nav-close" (click)="closeMobileNav()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="mobile-nav-links">
        <!-- Essen bestellen nur für Kunden (nicht für App-Admins) -->
        <a *ngIf="!isAuthenticated || hasCustomerRole" routerLink="/customer" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileNav()">
          <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <ellipse cx="12" cy="16" rx="8" ry="2"/>
            <ellipse cx="12" cy="14" rx="6" ry="1.5"/>
          </svg>
          <span class="mobile-nav-text">Essen bestellen</span>
        </a>
        <a *ngIf="!isAuthenticated || hasCustomerRole" routerLink="/auth/register-restaurant" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileNav()">
          <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l8 4v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6l8-4z"/>
            <path d="M8 10h8"/>
            <path d="M8 14h8"/>
            <circle cx="16" cy="8" r="1"/>
            <path d="M9 18l2 2 4-4"/>
          </svg>
          <span class="mobile-nav-text">Partner werden</span>
        </a>
        <a *ngIf="!isAuthenticated || hasCustomerRole" routerLink="/auth/register-wholesaler" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileNav()">
          <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <rect x="7" y="7" width="10" height="4"/>
            <rect x="7" y="13" width="10" height="4"/>
            <line x1="7" y1="11" x2="17" y2="11"/>
          </svg>
          <span class="mobile-nav-text">Großhändler werden</span>
        </a>
        <a *ngIf="hasAdminRole" routerLink="/admin" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileNav()">
          <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
          <span class="mobile-nav-text">Admin</span>
        </a>

        <!-- Customer Dashboard Link nur für Kunden -->
        <a *ngIf="hasCustomerRole" routerLink="/dashboard" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileNav()">
          <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <path d="M9 9h6v6H9z"/>
            <path d="M9 1v6"/>
            <path d="M15 1v6"/>
            <path d="M9 17v6"/>
            <path d="M15 17v6"/>
            <path d="M1 9h6"/>
            <path d="M17 9h6"/>
            <path d="M1 15h6"/>
            <path d="M17 15h6"/>
          </svg>
          <span class="mobile-nav-text">Mein Dashboard</span>
        </a>

        <!-- Driver Dashboard Link nur für Fahrer -->
        <a *ngIf="hasDriverRole" routerLink="/driver-dashboard" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileNav()">
          <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="3" width="15" height="13"/>
            <polygon points="16,8 20,8 23,11 23,16 16,16 16,8"/>
            <circle cx="5.5" cy="18.5" r="2.5"/>
            <circle cx="18.5" cy="18.5" r="2.5"/>
          </svg>
          <span class="mobile-nav-text">Fahrer-Dashboard</span>
        </a>
      </div>

      <!-- User Section für Mobile -->
      <div class="mobile-nav-user-section">
        <!-- Restaurant Name für Manager -->
        <div class="mobile-nav-restaurant-name" *ngIf="hasManagerRole">
          <div class="restaurant-name-display" (click)="toggleRoleDisplay()" [class.showing-role]="showRole">
            <svg class="restaurant-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
            <span class="restaurant-name">{{ getSelectedRestaurantName() || 'Restaurant' }}</span>
            <span class="user-role" *ngIf="showRole">{{ getCurrentUserRole() }}</span>
          </div>
        </div>

        <ng-container *ngIf="isAuthenticated; else mobileGuestSection">
          <div class="mobile-user-info">
            <svg class="user-avatar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <span class="user-name">{{ (currentUser$ | async)?.name || 'User' }}</span>
          </div>
          <button class="mobile-nav-logout-btn" (click)="logout()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16,17 21,12 16,7"/>
              <line x1="21" y1="12" x2="3" y2="12"/>
            </svg>
            Abmelden
          </button>
        </ng-container>
        <ng-template #mobileGuestSection>
          <div class="mobile-user-info">
            <svg class="user-avatar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <span class="user-name">Gast</span>
          </div>
          <button class="mobile-nav-login-btn" routerLink="/auth/login" (click)="closeMobileNav()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
              <polyline points="10,17 15,12 10,7"/>
              <line x1="15" y1="12" x2="3" y2="12"/>
            </svg>
            Anmelden
          </button>
        </ng-template>
      </div>
    </div>
  </nav>

  <main class="app-main">
    <router-outlet></router-outlet>
  </main>

  <!-- Global Loading Overlay -->
  <div class="global-loading-overlay" *ngIf="isGlobalLoading$ | async">
    <app-loading-spinner size="lg" text="Lädt..."></app-loading-spinner>
  </div>

  <!-- Global Toast Container -->
  <app-toast-container></app-toast-container>

  <!-- Global Confirmation Dialog -->
  <app-confirmation-dialog></app-confirmation-dialog>

  <!-- AI Chat Widget (global verfügbar) -->
  <app-ai-chat-widget></app-ai-chat-widget>
</div>
